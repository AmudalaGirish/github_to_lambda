<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link href= "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href= "https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" rel="stylesheet" >
 
    <style>
      body { margin: 0; font-family: Roboto, "Helvetica Neue", sans-serif; }

.submit-button{
    display:flex;
    justify-content: center;
    align-items: center;
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.form-header{
    display: flex;
    font-size: 25px;
    font-weight: 500;
    align-items: center;
    padding: 10px 0px;
}


.table.dataTable{
    width: inherit!important;
    
}

.dataTables_wrapper{
    font-size: small;

}



    </style>
</head>
<body>

    <div class="container">
      <div class="form-header">
 
          <div class="form-header-content">Manage All Subscription</div>
          
      </div>
      <div class="row" >
         <table id= "seller-table" class="table table-striped table-responsive">
		  <thead>
			<tr>
			  <th scope="col">Subscription Name</th>
			  <th scope="col">Offer ID</th>
              <th scope="col">Plan ID</th>
			  <th scope="col">Status</th>
			  <th scope="col">Action</th>
			</tr>
		  </thead>
         </table>
         
      </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
  <script src = "https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src = "https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
   <script src = " https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  
  <script>  
 



    $(document).ready(function() {
        
        // "url" : "https://uq5ld94opd.execute-api.ap-south-1.amazonaws.com/v1/subscriptions",
        var table =  $('#seller-table').DataTable({
         searching: false,
         ordering:false,
         paging:false,
         info:false,

        "processing" : true,
        "ajax" : {
            "url" :"https://uq5ld94opd.execute-api.ap-south-1.amazonaws.com/v1/subscriptions",            
            dataSrc : "body"
        },
         "columns" : [ {
            "data" : "subscriptionId"
        }, {
            "data" : "offerId"
        },  {
            "data" : "planId"
        },{
            "data" : "saasSubscriptionStatus"
        }, {
            "data" : null
        }],
        columnDefs: [{
        // puts a button in the last column
        targets: [-1], render: function (a, b, data, d) {
            console.log("status",data)
            if (data.saasSubscriptionStatus =="Pending") {
                return "<button type='submit' id='action' name='action' class='btn btn-primary btn-sm action'>Activate</button>";
            }
            return "";
        }
    }],
    });

        table.on("click", "button",
                function () {

                axios({
                method: 'POST',
                url: 'https://uq5ld94opd.execute-api.ap-south-1.amazonaws.com/v1/activate',
                data: table.rows($(this).closest("tr")).data()[0]
            }).then(res=>{
                console.log("success",res)
                //table.buttons().disable();
                $('.action').prop('disabled', true);
                console.log(table.rows($(this).closest("tr")))
                //console.log(table.rows($(this).closest("tr")).data()[0])
                    //table.ajax.reload();
                
                    //alert(table.rows($(this).closest("tr")).data());
                   
                })
            .catch(err=>{
                console.log(err)
            })
                  
});

    })



  </script>
</body>
</html>

