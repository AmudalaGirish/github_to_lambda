<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link href= "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href= "https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" rel="stylesheet" >
 
    <style>
      body { margin: 0; font-family: Roboto, "Helvetica Neue", sans-serif; }

.submit-button{
    display:flex;
    justify-content: center;
    align-items: center;
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.form-header{
    display: flex;
    font-size: 25px;
    font-weight: 500;
    align-items: center;
    padding: 10px 0px;
}

/* .dataTables_filter{
display:none;
} */


.table.dataTable{
    width: inherit!important;
    
}

.dataTables_wrapper{
    font-size: small;

}

.main{
    margin:50px;
}



    </style>
</head>
<body>

    <div class="main">
      <div class="form-header">
 
          <div class="form-header-content">Manage All Subscriptions</div>
          
      </div>
      <div class="row" >
         <table id= "seller-table" class="table table-striped table-responsive">
		  <thead>
			<tr>
              <th scope="col">Name</th>
              <th scope="col">Purchaser Email</th>
              <th scope="col">Beneficiary Email</th>
			  <th scope="col">Subscription Name</th>
			  <th scope="col">Offer ID</th>
              <th scope="col">Plan ID</th>
			  <th scope="col">Status</th>
			  <th scope="col">Action</th>
			</tr>
		  </thead>
         </table>
         
      </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
  <script src = "https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src = "https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
   <script src = " https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  
  <script>  
 



    $(document).ready(function() {
        
        // "url" : "https://uq5ld94opd.execute-api.ap-south-1.amazonaws.com/v1/subscriptionlist?offer=xor-test-offer-preview"
        var table =  $('#seller-table').DataTable({
         searching: true,
         ordering:false,
         //info:false,

        "processing" : true,
        "ajax" : {
            "url" :"https://uq5ld94opd.execute-api.ap-south-1.amazonaws.com/v1/subscriptionlist?offer=xor-test-offer-preview",          
             dataSrc : "data"
        },
		
         "columns" : [ {
            "data" : "customer_name","className":"searchable"
        }, {
            "data" : "subscription.purchaser.emailId","className":"searchable"
        }, {
            "data" : "subscription.beneficiary.emailId","className":"searchable"
        },{
            "data" : "subscriptionId"
        }, {
            "data" : "offerId","className":"editable"
        },  {
            "data" : "planId","className":"editable"
        },{
            "data" : "saasSubscriptionStatus","className":"editable"
        }, {
            "data" : null
        }],
        columnDefs: [{
        // puts a button in the last column
        targets: [-1], render: function (a, b, data, d) {
            console.log("status",data)
            if (data.saasSubscriptionStatus =="Pending") {
                return "<button type='submit' id='action' name='action' class='btn btn-primary btn-sm action'>Activate</button>";
            }
            return "";
        }
    }],




    // initComplete: function () {
    //        this.api()
    //             .columns('.editable').
    //             every(function () {
    //                 var column = this;
					
    //                 var select = $('<select><option value=""></option></select>')
    //                     .appendTo($(column.header()))
    //                     .on('change', function () {
    //                         var val = $.fn.dataTable.util.escapeRegex($(this).val());
 
    //                         column.search(val ? '^' + val + '$' : '', true, false).draw();
    //                     });
 
    //                 column
    //                     .data()
    //                     .unique()
    //                     .sort()
    //                     .each(function (d, j) {
    //                         select.append('<option value="' + d + '">' + d + '</option>');
    //                     });
						
    //             });

               
				
    //     },
	
		initComplete: function () {
           var t= this.api()
                .columns('.editable')

            var s = this.api()
                .columns('.searchable')

                t.every(function () {
                    var column = this;
					
                    var select = $('<br><select><option value=""></option></select>')
                        .appendTo($(column.header()))
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val());
 
                            column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });
 
                    column
                        .data()
                        .unique()
                        .sort()
                        .each(function (d, j) {
                            select.append('<option value="' + d + '">' + d + '</option>');
                        });
						
                });

                s.every(function () {
                    var column = this;
					
                    var select = $('<br><input type="text" placeholder="Search" />')
                        .appendTo($(column.header()))
                        .on('keyup change', function () {

                            if ( column.search() !== this.value ) {
                             column
                         .search( this.value )
                         .draw();
                         }
                            // var val = $.fn.dataTable.util.escapeRegex($(this).val());
 
                            // column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });
 
						
                });
				
        },

       
		
	
    });

    // $('table thead th').clone(true).appendTo( 'table thead' );
    //      $('table thead tr:eq(0) th').each( function (i) {
    //          if(i>=0 && i<=1){
    //          var title = $(this).text();
            
    //          $(this).html( '<input type="text" placeholder="Search '+title+'" />' );

    //          $( 'input', this ).on( 'keyup change', function () {
    //              if ( table.column(i).search() !== this.value ) {
    //                  table
    //                      .column(i)
    //                      .search( this.value )
    //                      .draw();
    //              }
    //          } );
            
    //         }
    //      } );

        table.on("click", "button",
                function () {

                axios({
                method: 'POST',
                url: 'http://localhost:3000/enroll',
                data: table.rows($(this).closest("tr")).data()[0]
            }).then(res=>{
                console.log("success",res)
                //table.buttons().disable();
                $('.action').prop('disabled', true);
                console.log(table.rows($(this).closest("tr")))
                //console.log(table.rows($(this).closest("tr")).data()[0])
                    //table.ajax.reload();
                
                    //alert(table.rows($(this).closest("tr")).data());
                   
                })
            .catch(err=>{
                console.log(err)
            })
                  
});

    })




   



  </script>
</body>
</html>





